<!doctype html>
<html>

<head>
	<title>QUnit: Image Load</title>
	<link rel="stylesheet" href="qunit/qunit.css" />
	<style>img { display: block; }</style>

	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
	<script src="../ahpi.imgload.js"></script>
	<script src="qunit/qunit.js"></script>
	<script>
function log(msg) {
	if (window.console && console.log) {
		console.log(msg);
	}
}

$(window).load(function () {
	test("Image load event (Normal)", function () {

		expect(1);

		$('#normal')
			// NASA image URL from Dean Edwards (http://dean.edwards.name/my/busted.html)
			.attr('src', 'http://www.nasa.gov/images/content/84857main_EC04-0325-23_lg.jpg?' + Math.random())
			.bind('load', function () {
				log('normal ' + this.src);
				ok(true, "Load event fired");
				start();
			});
		stop();
	});

	test("Image load event (Cached)", function () {

		expect(1);

		$('#cached')
			.bind('load', function () {
				log('cached ' + this.src);
				ok(true, "Load event fired");
				start();
			});
		stop();
	});

	test("Image load event (Data URI)", function () {

		expect(1);

		$('#datauri')
			.bind('error', function () {
				log('data uri error ' + this.src);
				ok(true, "Data URI not supported");
				start();
			})
			.bind('load', function () {
				log('data uri load ' + this.src);
				ok(true, "Load event fired");
				start();
			});
		stop();
	});

	test("Multiple load event handlers", function () {
		var count = 0;

		expect(1);

		$('#multiple').bind('load', function () {
			count++;
			log('first handler ' + this.src);
		});
		setTimeout(function () {
			$('#multiple').bind('load', function () {
				count++;
				log('second handler ' + this.src);
			});
		}, 1000);
		setTimeout(function () {
			equal(count, 2, "Previous load event handler not called when new handler is bound");
			start();
		}, 2000);

		stop();
	});
});
	</script>

</head>

<body>

<p>
	<img id="normal" src="" height="240" width="300" />
	<img id="cached" src="cached.gif" />
	<img id="datauri" src="data:image/gif;base64,R0lGODdhGwAPAIAAAP///wAAACwAAAAAGwAPAAACN4SPqcvtD08IaIKJrclab+pdlDR+FViK50qq7Wu2XOjGJreEOmrDteqhCUed1E6R8RWTkaYzUgAAOw==" />
	<img id="multiple" src="cached.gif" width="1" height="1" />
	<a href="../ahpi.imgload.js">ahpi.imgload.js Source</a>
</p>

<ol id="qunit-tests"></ol>
</body>

</html>
